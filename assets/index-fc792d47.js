import"https://cdn.jsdelivr.net/gh/aframevr/aframe@ef03254934395d6a0a3cd093a8d37bb90790d24e/dist/aframe-master.min.js";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}let s,l;function i(t,e){return t!=t?e==e:t!==e}function a(t,e,n,o){return t[1]&&o?((t,e)=>{for(const n in e)t[n]=e[n];return t})(n.ctx.slice(),t[1](o(e))):n.ctx}function c(t,e){t.appendChild(e)}function u(t,e,n){t.insertBefore(e,n||null)}function d(t){t.parentNode&&t.parentNode.removeChild(t)}function f(t){return document.createElement(t)}function h(t){return document.createTextNode(t)}function p(){return h(" ")}function m(){return h("")}function g(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function $(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function y(t,e,n){e in t?t[e]="boolean"==typeof t[e]&&""===n||n:$(t,e,n)}function b(t){l=t}const x=[],w=[];let E=[];const v=[],_=Promise.resolve();let M=!1;function T(t){E.push(t)}const R=new Set;let C=0;function H(){if(0!==C)return;const t=l;do{try{for(;C<x.length;){const t=x[C];C++,b(t),k(t.$$)}}catch(e){throw x.length=0,C=0,e}for(b(null),x.length=0,C=0;w.length;)w.pop()();for(let t=0;t<E.length;t+=1){const e=E[t];R.has(e)||(R.add(e),e())}E.length=0}while(x.length);for(;v.length;)v.pop()();M=!1,R.clear(),b(t)}function k(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(T)}}const A=new Set;let S;function L(){S={r:0,c:[],p:S}}function N(){S.r||o(S.c),S=S.p}function B(t,e){t&&t.i&&(A.delete(t),t.i(e))}function P(t,e,n,o){if(t&&t.o){if(A.has(t))return;A.add(t),S.c.push((()=>{A.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}else o&&o()}function z(t){return void 0!==t?.length?t:Array.from(t)}function j(t,n,s){const{fragment:l,after_update:i}=t.$$;l&&l.m(n,s),T((()=>{const n=t.$$.on_mount.map(e).filter(r);t.$$.on_destroy?t.$$.on_destroy.push(...n):o(n),t.$$.on_mount=[]})),i.forEach(T)}function F(t,e){const n=t.$$;null!==n.fragment&&((t=>{const e=[],n=[];E.forEach((o=>-1===t.indexOf(o)?e.push(o):n.push(o))),n.forEach((t=>t())),E=e})(n.after_update),o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function O(e,r,s,i,a,c,u,f=[-1]){const h=l;b(e);const p=e.$$={fragment:null,ctx:[],props:c,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(r.context||(h?h.$$.context:[])),callbacks:n(),dirty:f,skip_bound:!1,root:r.target||h.$$.root};u&&u(p.root);let m=!1;if(p.ctx=s?s(e,r.props||{},((t,n,...o)=>{const r=o.length?o[0]:n;return p.ctx&&a(p.ctx[t],p.ctx[t]=r)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](r),m&&((t,e)=>{-1===t.$$.dirty[0]&&(x.push(t),M||(M=!0,_.then(H)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31})(e,t)),n})):[],p.update(),m=!0,o(p.before_update),p.fragment=!!i&&i(p.ctx),r.target){if(r.hydrate){const t=(t=>Array.from(t.childNodes))(r.target);p.fragment&&p.fragment.l(t),t.forEach(d)}else p.fragment&&p.fragment.c();r.intro&&B(e.$$.fragment),j(e,r.target,r.anchor),H()}b(h)}class I{$$=void 0;$$set=void 0;$destroy(){F(this,1),this.$destroy=t}$on(e,n){if(!r(n))return t;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const t=o.indexOf(n);-1!==t&&o.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");const q=t=>t.el,D=t=>t.data,G=(t,e,n)=>q(t).addEventListener(e,n);let V=t=>new THREE.MeshStandardMaterial(t),K=(...t)=>new THREE.InstancedMesh(...t),X=(t=0,e=0,n)=>new THREE.Mesh(new THREE.PlaneGeometry(t,e),V(n)),W=THREE;var J;J={init(){let t=D(this);t.lastPoint=new W.Vector3(-9999),G(this,"raycaster-intersected",(e=>t.raycaster=e.detail.el)),G(this,"raycaster-intersected-cleared",(()=>t.raycaster=void 0))},tick(){let t=D(this),{lastPoint:e}=t,n=q(this),o=t.raycaster?.components.raycaster.getIntersection(n);if(!o)return;let{point:r}=o;r.x===e.x&&r.y===e.y&&r.z===e.z||(n.emit("intersection",o),t.lastPoint=r)}},AFRAME.registerComponent("raycasted",{...J,init(){this.system?.register(this.el),J.init?.call(this)},remove(){this.system?.deregister(this.el)}});let Q="#18A558",U="#7BD5F5",Y="tan",Z={scene:void 0},tt=()=>Z,{random:et}=Math,nt=new W.Matrix4,ot=new W.Vector3;const rt=(t=.1,e=.1,n=.1,o=0,r=0,s=0,l)=>K(new W.BoxGeometry(t,e,n).translate(o,r,s),V({color:l}),500);let st=(t,e=1)=>{let n=[],o=.4*e,r=0;n.push(ot.set(o,0,r).clone()),o+=.5*e,n.push(ot.set(o,0,r).clone());for(let u=0;u<10;u++)o+=Math.random()*e,r=2*(Math.random()-.5),n.push(ot.set(o,0,r).clone());let s=new THREE.CatmullRomCurve3(n),l=new THREE.CatmullRomCurve3(s.getPoints(100)),i=new THREE.TubeGeometry(l,100,.02,8,!1),a=new THREE.MeshBasicMaterial({color:"#B0BEC5"}),c=new THREE.Mesh(i,a);t.add(c)},lt=t=>t.getBoundingClientRect();function it(t){let e,n;const o=t[2].default,r=((t,e,n,o)=>{if(t){const o=a(t,e,n,null);return t[0](o)}})(o,t,t[1]);return{c(){e=f("div"),r&&r.c(),$(e,"class","absolute -top-full -left-full px-24 py-24")},m(o,s){u(o,e,s),r&&r.m(e,null),t[3](e),n=!0},p(t,[e]){r&&r.p&&(!n||2&e)&&((t,e,n,o,r,s)=>{if(r){const s=a(e,n,o,null);t.p(s,r)}})(r,o,t,t[1],n?((t,e,n,o)=>(t[2],e.dirty))(o,t[1]):(t=>{if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let t=0;t<n;t++)e[t]=-1;return e}return-1})(t[1]))},i(t){n||(B(r,t),n=!0)},o(t){P(r,t),n=!1},d(n){n&&d(e),r&&r.d(n),t[3](null)}}}function at(t,e,n){let o,{$$slots:r={},$$scope:s}=e;return i=()=>{let t=(t=>{let e=document.createRange(),n=lt(t),o=document.createElement("canvas");o.width=n.width,o.height=n.height;let r=o.getContext("2d"),s=(t,o)=>{if(t.nodeType===Node.TEXT_NODE){e.selectNode(t);let s=lt(e);((t,e,n,o)=>{r.font=`${t.fontWeight} ${t.fontSize} ${t.fontFamily}`,r.textBaseline="top",r.fillStyle=t.color,r.fillText(o,e,n+.1*(0|t.fontSize))})(o,s.left-n.left-.5,s.top-n.top-.5,t.nodeValue.trim())}else o=window.getComputedStyle(t);for(let e of t.childNodes)s(e,o)};return s(t,{}),o})(o),{scene:e}=tt(),n=new W.CanvasTexture(t);n.anisotropy=4;let r=X(.4,.4,{map:n,transparent:!0});r.position.z=.001;let s=X(.4,.4,{color:"#fff"});s.position.set(0,1,0),s.rotation.x=-Math.PI/4,s.add(r),e.add(s)},(()=>{if(!l)throw new Error("Function called outside component initialization");return l})().$$.on_mount.push(i),t.$$set=t=>{"$$scope"in t&&n(1,s=t.$$scope)},[o,s,r,t=>{w[t?"unshift":"push"]((()=>{o=t,n(0,o)}))}];var i}class ct extends I{constructor(t){super(),O(this,t,at,it,i,{})}}const ut=[];let dt=((e,n=t)=>{let o;const r=new Set;function s(t){if(((t,e)=>t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t)(e,t)&&(e=t,o)){const t=!ut.length;for(const n of r)n[1](),ut.push(n,e);if(t){for(let t=0;t<ut.length;t+=2)ut[t][0](ut[t+1]);ut.length=0}}}function l(t){s(t(e))}return{set:s,update:l,subscribe(i,a=t){const c=[i,a];return r.add(c),1===r.size&&(o=n(s,l)||t),i(e),()=>{r.delete(c),0===r.size&&o&&(o(),o=null)}}}})(localStorage.getItem("state")??"screen");function ft(t,e,n){const o=t.slice();o[8]=e[n];const r=o[8]===wt;return o[9]=r,o}function ht(e){let n;return{c(){n=f("a-entity"),y(n,"laser-controls","hand:"+e[8]),y(n,"raycaster","objects:.collidable;lineOpacity:$"+(e[9]?1:0)+";enabled:"+e[9]+";autoRefresh:false")},m(t,e){u(t,n,e)},p:t,d(t){t&&d(n)}}}function pt(t){let e,n,r,l,i,a,h,$,b,x,w;const E=[gt,mt],v=[];function _(t,e){return 4&e&&(i=null),"screen"===t[2]?0:(null==i&&(i=!!["intro","tutorial"].includes(t[2])),i?1:-1)}return~(a=_(t,-1))&&(h=v[a]=E[a](t)),{c(){var t,o;e=f("a-cylinder"),n=f("a-gltf-model"),l=p(),h&&h.c(),$=m(),(t=n.src)!==(o=r="castle.glb")&&(s||(s=document.createElement("a")),s.href=o,t!==s.href)&&y(n,"src","castle.glb"),y(n,"shadow",""),y(e,"radius",30),y(e,"height",.01),y(e,"position","0 0 0"),y(e,"color",Q),y(e,"class","collidable"),y(e,"raycasted","")},m(o,r){u(o,e,r),c(e,n),u(o,l,r),~a&&v[a].m(o,r),u(o,$,r),b=!0,x||(w=[g(n,"loaded",t[4]),g(e,"intersection",t[5])],x=!0)},p(t,e){let n=a;a=_(t,e),a===n?~a&&v[a].p(t,e):(h&&(L(),P(v[n],1,1,(()=>{v[n]=null})),N()),~a?(h=v[a],h?h.p(t,e):(h=v[a]=E[a](t),h.c()),B(h,1),h.m($.parentNode,$)):h=null)},i(t){b||(B(h),b=!0)},o(t){P(h),b=!1},d(t){t&&(d(e),d(l),d($)),~a&&v[a].d(t),x=!1,o(w)}}}function mt(t){let e,n;return e=new ct({props:{$$slots:{default:[bt]},$$scope:{ctx:t}}}),{c(){var t;(t=e.$$.fragment)&&t.c()},m(t,o){j(e,t,o),n=!0},p(t,n){const o={};4100&n&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){n||(B(e.$$.fragment,t),n=!0)},o(t){P(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function gt(e){let n;return{c(){n=f("h1"),n.innerHTML="<q>Keep Calm</q>",$(n,"class","fixed text-white text-9xl text-center w-screen")},m(t,e){u(t,n,e)},p:t,i:t,o:t,d(t){t&&d(n)}}}function $t(t){let e;return{c(){e=f("div"),e.innerHTML='<p class="text-6xl">Hail, my Liege.</p> <p class="mt-0 mb-16">Thou art The King - if perchance you forgot again today.</p> <p>I must apprise thee that your chosen people are envied</p> <p class="mt-0 mb-16">for being, well, chosen.</p> <p>Please muster thy utmost valor to defend them,</p> <p class="mt-0 mb-16">they&#39;re all really good chaps once you get past the smell.</p> <p>Sincerely, thy most humble and abasing subject,</p> <p>Humphrey Bumblebuns, XO</p>',$(e,"class","h-[900px] w-[1100px] text-5xl")},m(t,n){u(t,e,n)},d(t){t&&d(e)}}}function yt(t){let e;return{c(){e=f("div"),e.textContent="Pull the trigger on thy divine scepter to fire lasers. Hallowed by thy aim.\n\n          Lobby thy royal orb at foes to make them bend the knee to thy 2 megaton explosions.",$(e,"class","h-[900px] w-[1100px] text-5xl")},m(t,n){u(t,e,n)},d(t){t&&d(e)}}}function bt(t){let e,n,o="intro"===t[2]&&$t(),r="tutorial"===t[2]&&yt();return{c(){o&&o.c(),e=p(),r&&r.c(),n=m()},m(t,s){o&&o.m(t,s),u(t,e,s),r&&r.m(t,s),u(t,n,s)},p(t,s){"intro"===t[2]?o||(o=$t(),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null),"tutorial"===t[2]?r||(r=yt(),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},d(t){t&&(d(e),d(n)),o&&o.d(t),r&&r.d(t)}}}function xt(t){let e,n,r,s,l,i,a,h,m,$,b,x=z([wt,Et]),w=[];for(let o=0;o<2;o+=1)w[o]=ht(ft(t,x,o));let E=t[1]&&pt(t);return{c(){e=f("a-scene"),n=f("a-sky"),r=p(),s=f("a-light"),l=p(),i=f("a-camera"),a=p();for(let t=0;t<2;t+=1)w[t].c();h=p(),E&&E.c(),y(n,"color",U),y(s,"type","ambient"),y(s,"color","#445451"),y(i,"position","0 0.5 1.8"),y(i,"look-controls-enabled","false"),y(e,"reflection",""),y(e,"fog","far:5;color:"+U),y(e,"shadow","type:pcfsoft"),y(e,"renderer","antialias:true;colorManagement:true;highRefreshRate:true;physicallyCorrectLights:true;toneMapping:ACESFilmic")},m(o,d){u(o,e,d),c(e,n),c(e,r),c(e,s),c(e,l),c(e,i),c(e,a);for(let t=0;t<2;t+=1)w[t]&&w[t].m(e,null);c(e,h),E&&E.m(e,null),m=!0,$||(b=[g(e,"loaded",t[3]),g(e,"enter-vr",t[6])],$=!0)},p(t,[n]){if(0&n){let o;for(x=z([wt,Et]),o=0;o<2;o+=1){const r=ft(t,x,o);w[o]?w[o].p(r,n):(w[o]=ht(r),w[o].c(),w[o].m(e,h))}for(;o<2;o+=1)w[o].d(1)}t[1]?E?(E.p(t,n),2&n&&B(E,1)):(E=pt(t),E.c(),B(E,1),E.m(e,null)):E&&(L(),P(E,1,1,(()=>{E=null})),N())},i(t){m||(B(E),m=!0)},o(t){P(E),m=!1},d(t){t&&d(e),((t,e)=>{for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)})(w,t),E&&E.d(),$=!1,o(b)}}}let wt="right",Et="left";function vt(e,n,o){let r;var s,l;s=dt,l=t=>o(2,r=t),e.$$.on_destroy.push(((e,...n)=>{if(null==e){for(const t of n)t(void 0);return t}const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o})(s,l));let i=tt(),a=!1;return[i,a,r,t=>{let e=(t=>t.target.object3D)(t);o(0,i.scene=e,i),(()=>{let{scene:t}=tt(),e=K(new THREE.ConeGeometry(.1,.5),V({color:"green"}),1e3);for(let n=0;n<1e3;n++){let[t,o]=(t=>{let e=2*Math.PI*et();return[t*Math.cos(e),t*Math.sin(e)]})(2*Math.sqrt(et())+2),r=et()+.3;e.setMatrixAt(n,nt.makeTranslation(ot.set(t,.25*r,o)).scale(ot.set(et()+.3,r,et()+.3)))}t.add(e)})(),(()=>{let{scene:t}=tt(),e=.01,n=.005,o=.0175,r=[rt(e,e,e,0,.04,0,Y),rt(.02,.03,.004,0,.02,0,"brown"),rt(n,o,n,-.012,.025,0,Y),rt(n,o,n,.012,.025,0,Y)],s=new Float32Array(1e3);for(let l=0;l<1e3;l+=2)s[l+1]=.25+.02*l;t.add(...r);for(let l=0,i=0;l<500;l++,i+=2)for(let t of r)t.setMatrixAt(l,nt.makeTranslation(ot.set(s[i],0,s[i+1])))})(),st(e),st(e,-1),(t=>{let e=new THREE.DirectionalLight("#fff",2);t.add(e),e.position.set(1,2,1),e.target;let{shadow:n}=e;n.bias=1e-5,n.mapSize.set(2048,2048),n.normalBias=.02;let{camera:o}=n;o.left=o.bottom=-5,o.right=o.top=5})(e),o(1,a=!0)},()=>{return t=i.scene,requestAnimationFrame((()=>t.traverse((t=>{const e=t;e.castShadow=e.isMesh||e.isLight&&!e.isAmbientLight&&!e.isRectAreaLight,e.receiveShadow=e.isMesh}))));var t},t=>{},()=>{return t=r="intro",e=r,dt.set(e),t;var t,e}]}new class extends I{constructor(t){super(),O(this,t,vt,xt,i,{})}}({target:document.body});
